<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=preload as=font href=https://www.springcloud.io/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=https://www.springcloud.io/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><link rel=stylesheet href=https://www.springcloud.io/main.f61ba0b6506edcc484748b67eeea0f249895b5bd362b0928a3f132e9b2c0b3e512f1defc1cf3ec85bcb0fbad5855c145ce61cbe61136910c72f957c3a6581cff.css integrity="sha512-9hugtlBu3MSEdItn7uoPJJiVtb02Kwkoo/Ey6bLAs+US8d78HPPshbyw+61YVcFFzmHL5hE2kQxy+VfDplgc/w==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=keywords content="springcloudå®˜æ–¹,springcloudä¸­æ–‡æ–‡æ¡£,springcloudæœ€æ–°æ–‡æ¡£,springcloudä¸­å›½"><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>Spring Cloud Netflix - SpringCloudä¸­æ–‡ç¤¾åŒº</title><meta name=description content="Spring Cloud Netflixé€šè¿‡è‡ªåŠ¨é…ç½®å’Œç»‘å®šåˆ°Springç¯å¢ƒå’Œå…¶ä»–Springç¼–ç¨‹æ¨¡å‹ä¹ è¯­ï¼Œä¸ºSpring Bootåº”ç”¨æä¾›äº†Netflix OSSé›†æˆã€‚é€šè¿‡ä¸€äº›ç®€å•çš„æ³¨é‡Šï¼Œæ‚¨å¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­å¿«é€Ÿå¯ç”¨å’Œé…ç½®é€šç”¨æ¨¡å¼ï¼Œå¹¶ä½¿ç”¨ç»è¿‡å®æˆ˜è€ƒéªŒçš„Netflixç»„ä»¶æ„å»ºå¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿã€‚æä¾›çš„æ¨¡å¼åŒ…æ‹¬æœåŠ¡å‘ç°(Eureka)ã€æ–­è·¯å™¨(Hystrix)ã€æ™ºèƒ½è·¯ç”±(Zuul)å’Œå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡(Ribbon)ã€‚"><link rel=canonical href=https://www.springcloud.io/docs/springcloud/spring-cloud-netflix/><meta property="og:locale" content="zh-CN"><meta property="og:type" content="article"><meta property="og:title" content="Spring Cloud Netflix"><meta property="og:description" content="Spring Cloud Netflixé€šè¿‡è‡ªåŠ¨é…ç½®å’Œç»‘å®šåˆ°Springç¯å¢ƒå’Œå…¶ä»–Springç¼–ç¨‹æ¨¡å‹ä¹ è¯­ï¼Œä¸ºSpring Bootåº”ç”¨æä¾›äº†Netflix OSSé›†æˆã€‚é€šè¿‡ä¸€äº›ç®€å•çš„æ³¨é‡Šï¼Œæ‚¨å¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­å¿«é€Ÿå¯ç”¨å’Œé…ç½®é€šç”¨æ¨¡å¼ï¼Œå¹¶ä½¿ç”¨ç»è¿‡å®æˆ˜è€ƒéªŒçš„Netflixç»„ä»¶æ„å»ºå¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿã€‚æä¾›çš„æ¨¡å¼åŒ…æ‹¬æœåŠ¡å‘ç°(Eureka)ã€æ–­è·¯å™¨(Hystrix)ã€æ™ºèƒ½è·¯ç”±(Zuul)å’Œå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡(Ribbon)ã€‚"><meta property="og:url" content="https://www.springcloud.io/docs/springcloud/spring-cloud-netflix/"><meta property="og:site_name" content="SpringCloudä¸­æ–‡ç¤¾åŒº"><meta property="article:published_time" content="2020-11-12T13:26:54+01:00"><meta property="article:modified_time" content="2020-11-12T13:26:54+01:00"><meta property="og:image" content="https://www.springcloud.io/doks.png"><meta property="og:image:alt" content="SpringCloudä¸­æ–‡ç¤¾åŒº"><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@getdoks"><meta name=twitter:creator content="@henkverlinde"><meta name=twitter:title content="Spring Cloud Netflix"><meta name=twitter:description content="Spring Cloud Netflixé€šè¿‡è‡ªåŠ¨é…ç½®å’Œç»‘å®šåˆ°Springç¯å¢ƒå’Œå…¶ä»–Springç¼–ç¨‹æ¨¡å‹ä¹ è¯­ï¼Œä¸ºSpring Bootåº”ç”¨æä¾›äº†Netflix OSSé›†æˆã€‚é€šè¿‡ä¸€äº›ç®€å•çš„æ³¨é‡Šï¼Œæ‚¨å¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­å¿«é€Ÿå¯ç”¨å’Œé…ç½®é€šç”¨æ¨¡å¼ï¼Œå¹¶ä½¿ç”¨ç»è¿‡å®æˆ˜è€ƒéªŒçš„Netflixç»„ä»¶æ„å»ºå¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿã€‚æä¾›çš„æ¨¡å¼åŒ…æ‹¬æœåŠ¡å‘ç°(Eureka)ã€æ–­è·¯å™¨(Hystrix)ã€æ™ºèƒ½è·¯ç”±(Zuul)å’Œå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡(Ribbon)ã€‚"><meta name=twitter:image content="https://www.springcloud.io/doks.png"><meta name=twitter:image:alt content="Spring Cloud Netflix"><script type=application/ld+json>{"@context":"https://schema.org","@graph":[{"@type":"Organization","@id":"https://www.springcloud.io/#/schema/organization/1","name":"Doks","url":"https://www.springcloud.io/","sameAs":["https://twitter.com/kevinblandy","https://github.com/KevinBlandy"],"logo":{"@type":"ImageObject","@id":"https://www.springcloud.io/#/schema/image/1","url":"https://www.springcloud.io/logo-doks.png","width":512,"height":512,"caption":"Doks"},"image":{"@id":"https://www.springcloud.io/#/schema/image/1"}},{"@type":"WebSite","@id":"https://www.springcloud.io/#/schema/website/1","url":"https://www.springcloud.io/","name":"SpringCloudä¸­æ–‡ç¤¾åŒº","description":"SpringCloudä¸­æ–‡ç¤¾åŒºä¸“æ³¨äºæ–‡æ¡£æ±‰åŒ–ï¼Œæ›´æ–°ï¼Œä»¥åŠè¡Œä¸šå‰æ²¿èµ„è®¯çš„å‘å¸ƒã€‚","publisher":{"@id":"https://www.springcloud.io/#/schema/organization/1"}},{"@type":"WebPage","@id":"https://www.springcloud.io/docs/springcloud/spring-cloud-netflix/","url":"https://www.springcloud.io/docs/springcloud/spring-cloud-netflix/","name":"Spring Cloud Netflix","description":"Spring Cloud Netflixé€šè¿‡è‡ªåŠ¨é…ç½®å’Œç»‘å®šåˆ°Springç¯å¢ƒå’Œå…¶ä»–Springç¼–ç¨‹æ¨¡å‹ä¹ è¯­ï¼Œä¸ºSpring Bootåº”ç”¨æä¾›äº†Netflix OSSé›†æˆã€‚é€šè¿‡ä¸€äº›ç®€å•çš„æ³¨é‡Šï¼Œæ‚¨å¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­å¿«é€Ÿå¯ç”¨å’Œé…ç½®é€šç”¨æ¨¡å¼ï¼Œå¹¶ä½¿ç”¨ç»è¿‡å®æˆ˜è€ƒéªŒçš„Netflixç»„ä»¶æ„å»ºå¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿã€‚æä¾›çš„æ¨¡å¼åŒ…æ‹¬æœåŠ¡å‘ç°(Eureka)ã€æ–­è·¯å™¨(Hystrix)ã€æ™ºèƒ½è·¯ç”±(Zuul)å’Œå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡(Ribbon)ã€‚","isPartOf":{"@id":"https://www.springcloud.io/#/schema/website/1"},"about":{"@id":"https://www.springcloud.io/#/schema/organization/1"},"datePublished":"2020-11-12T13:26:54CET","dateModified":"2020-11-12T13:26:54CET","breadcrumb":{"@id":"https://www.springcloud.io/docs/springcloud/spring-cloud-netflix/#/schema/breadcrumb/1"},"primaryImageOfPage":{"@id":"https://www.springcloud.io/docs/springcloud/spring-cloud-netflix/#/schema/image/2"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://www.springcloud.io/docs/springcloud/spring-cloud-netflix/"]}]},{"@type":"BreadcrumbList","@id":"https://www.springcloud.io/docs/springcloud/spring-cloud-netflix/#/schema/breadcrumb/1","name":"Breadcrumbs","itemListElement":[{"@type":"ListItem","position":1,"item":{"@type":"WebPage","@id":"https://www.springcloud.io","url":"https://www.springcloud.io","name":"Home"}},{"@type":"ListItem","position":3,"item":{"@type":"WebPage","@id":"https://www.springcloud.io/docs/","url":"https://www.springcloud.io/docs/","name":"Docs"}},{"@type":"ListItem","position":4,"item":{"@type":"WebPage","@id":"https://www.springcloud.io/docs/springcloud/","url":"https://www.springcloud.io/docs/springcloud/","name":"Springcloud"}},{"@type":"ListItem","position":5,"item":{"@id":"https://www.springcloud.io/docs/springcloud/spring-cloud-netflix/"}}]},{"@context":"https://schema.org","@graph":[{"@type":"Article","@id":"https://www.springcloud.io/#/schema/article/1","headline":"Spring Cloud Netflix","description":"Spring Cloud Netflixé€šè¿‡è‡ªåŠ¨é…ç½®å’Œç»‘å®šåˆ°Springç¯å¢ƒå’Œå…¶ä»–Springç¼–ç¨‹æ¨¡å‹ä¹ è¯­ï¼Œä¸ºSpring Bootåº”ç”¨æä¾›äº†Netflix OSSé›†æˆã€‚é€šè¿‡ä¸€äº›ç®€å•çš„æ³¨é‡Šï¼Œæ‚¨å¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­å¿«é€Ÿå¯ç”¨å’Œé…ç½®é€šç”¨æ¨¡å¼ï¼Œå¹¶ä½¿ç”¨ç»è¿‡å®æˆ˜è€ƒéªŒçš„Netflixç»„ä»¶æ„å»ºå¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿã€‚æä¾›çš„æ¨¡å¼åŒ…æ‹¬æœåŠ¡å‘ç°(Eureka)ã€æ–­è·¯å™¨(Hystrix)ã€æ™ºèƒ½è·¯ç”±(Zuul)å’Œå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡(Ribbon)ã€‚","isPartOf":{"@id":"https://www.springcloud.io/docs/springcloud/spring-cloud-netflix/"},"mainEntityOfPage":{"@id":"https://www.springcloud.io/docs/springcloud/spring-cloud-netflix/"},"datePublished":"2020-11-12T13:26:54CET","dateModified":"2020-11-12T13:26:54CET","author":{"@id":"https://www.springcloud.io/#/schema/person/2"},"publisher":{"@id":"https://www.springcloud.io/#/schema/organization/1"},"image":{"@id":"https://www.springcloud.io/docs/springcloud/spring-cloud-netflix/#/schema/image/2"}}]},{"@context":"https://schema.org","@graph":[{"@type":"Person","@id":"https://www.springcloud.io/#/schema/person/2","name":"kevinblandy","sameAs":["https://twitter.com/kevinblandy","https://github.com/KevinBlandy"]}]},{"@context":"https://schema.org","@graph":[{"@type":"ImageObject","@id":"https://www.springcloud.io/docs/springcloud/spring-cloud-netflix/#/schema/image/2","url":"https://www.springcloud.io/doks.png","contentUrl":"https://www.springcloud.io/doks.png","caption":"Spring Cloud Netflix"}]}]}</script><meta name=theme-color content="#fff"><link rel=apple-touch-icon sizes=180x180 href=https://www.springcloud.io/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://www.springcloud.io/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://www.springcloud.io/favicon-16x16.png><link rel=manifest crossorigin=use-credentials href=https://www.springcloud.io/site.webmanifest><script>var _hmt=_hmt||[];(function(){var a=document.createElement("script"),b;a.src="https://hm.baidu.com/hm.js?d725343fdb7604c5bd89b377295901df",b=document.getElementsByTagName("script")[0],b.parentNode.insertBefore(a,b)})()</script></head><body class="docs single"><div class="header-bar fixed-top"></div><header class="navbar fixed-top navbar-expand-md navbar-light"><div class=container><input class="menu-btn order-0" type=checkbox id=menu-btn>
<label class="menu-icon d-md-none" for=menu-btn><span class=navicon></span></label><a class="navbar-brand order-1 order-md-0 me-auto" href=https://www.springcloud.io/>SpringCloudä¸­æ–‡ç¤¾åŒº</a>
<button id=mode class="btn btn-link order-2 order-md-4" type=button aria-label="Toggle mode">
<span class=toggle-dark><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-moon"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg></span><span class=toggle-light><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-sun"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></span></button><ul class="navbar-nav social-nav order-3 order-md-5"></ul><div class="collapse navbar-collapse order-4 order-md-1"><ul class="navbar-nav main-nav me-auto order-5 order-md-2"><li class=nav-item><a class=nav-link href=https://www.springcloud.io/docs/>ä¸­æ–‡æ–‡æ¡£</a></li><li class=nav-item><a class=nav-link href=https://www.springcloud.io/blog/>è¡Œä¸šèµ„è®¯</a></li></ul><div class="break order-6 d-md-none"></div><form class="navbar-form flex-grow-1 order-7 order-md-3"><input id=userinput class="form-control is-search" type=search placeholder="Search docs..." aria-label="Search docs..." autocomplete=off><div id=suggestions class="shadow bg-white rounded"></div></form></div></div></header><div class="wrap container" role=document><div class=content><div class="row flex-xl-nowrap"><div class="col-lg-5 col-xl-4 docs-sidebar"><nav class=docs-links aria-label="Main navigation"><ul class="list-unstyled collapsible-sidebar"><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-SpringBoot aria-expanded=false>
SpringBoot</button></li><li class=mb-1><button class="btn btn-toggle align-items-center rounded collapsed" data-bs-toggle=collapse data-bs-target=#section-SpringCloud aria-expanded=true>
SpringCloud</button><div class="collapse show" id=section-SpringCloud><ul class="btn-toggle-nav list-unstyled fw-normal pb-1 small"><li><a class="docs-link rounded" href=https://www.springcloud.io/docs/springcloud/spring-cloud-alibaba/>Spring Cloud Alibaba</a></li><li><a class="docs-link rounded" href=https://www.springcloud.io/docs/springcloud/spring-cloud-bus/>Spring Cloud Bus</a></li><li><a class="docs-link rounded" href=https://www.springcloud.io/docs/springcloud/spring-cloud-circuit-breaker/>Spring Cloud Circuit Breaker</a></li><li><a class="docs-link rounded" href=https://www.springcloud.io/docs/springcloud/spring-cloud-consul/>Spring Cloud Consul</a></li><li><a class="docs-link rounded" href=https://www.springcloud.io/docs/springcloud/spring-cloud-gateway/>Spring Cloud Gateway</a></li><li><a class="docs-link rounded" href=https://www.springcloud.io/docs/springcloud/spring-cloud-kubernetes/>Spring Cloud Kubernetes</a></li><li><a class="docs-link rounded active" href=https://www.springcloud.io/docs/springcloud/spring-cloud-netflix/>Spring Cloud Netflix</a></li></ul></div></li></ul></nav></div><nav class="docs-toc d-none d-xl-block col-xl-3" aria-label="Secondary navigation"><div class=page-links><h3>On this page</h3><nav id=TableOfContents><ul><li><a href=#1-æœåŠ¡å‘ç°eurekaå®¢æˆ·ç«¯>1 æœåŠ¡å‘ç°ï¼šEurekaå®¢æˆ·ç«¯</a><ul><li><a href=#11-å¦‚ä½•å¼•å…¥eurekaå®¢æˆ·ç«¯>1.1 å¦‚ä½•å¼•å…¥Eurekaå®¢æˆ·ç«¯</a></li><li><a href=#12-å‘eurekaæ³¨å†ŒæœåŠ¡>1.2 å‘Eurekaæ³¨å†ŒæœåŠ¡</a></li><li><a href=#13-åœ¨eurekaæœåŠ¡ç«¯ä¸ŠéªŒè¯>1.3 åœ¨EurekaæœåŠ¡ç«¯ä¸ŠéªŒè¯</a></li><li><a href=#14-çŠ¶æ€é¡µå’Œå¥åº·æŒ‡ç¤ºå™¨>1.4 çŠ¶æ€é¡µå’Œå¥åº·æŒ‡ç¤ºå™¨</a></li><li><a href=#15-æ³¨å†Œå®‰å…¨çš„åº”ç”¨ç¨‹åº>1.5 æ³¨å†Œå®‰å…¨çš„åº”ç”¨ç¨‹åº</a></li><li><a href=#16-eurekaçš„å¥åº·æ£€æŸ¥>1.6 Eurekaçš„å¥åº·æ£€æŸ¥</a></li><li><a href=#17-eurekaå®¢æˆ·ç«¯å’Œå®ä¾‹çš„å…ƒæ•°æ®>1.7 Eurekaå®¢æˆ·ç«¯å’Œå®ä¾‹çš„å…ƒæ•°æ®</a></li><li><a href=#172-åœ¨awsä¸Šä½¿ç”¨eureka>1.7.2 åœ¨AWSä¸Šä½¿ç”¨Eureka</a></li><li><a href=#173-ä¿®æ”¹eurekaçš„å®ä¾‹id>1.7.3 ä¿®æ”¹Eurekaçš„å®ä¾‹ID</a></li><li><a href=#18-ä½¿ç”¨eurekaclient>1.8 ä½¿ç”¨EurekaClient</a></li><li><a href=#19-æ›¿ä»£åŸç”Ÿnetflix-eurakaclient>1.9 æ›¿ä»£åŸç”ŸNetflix EurakaClient</a></li><li><a href=#110-ä¸ºä»€ä¹ˆæ³¨å†ŒæœåŠ¡å¦‚æ­¤ç¼“æ…¢>1.10 ä¸ºä»€ä¹ˆæ³¨å†ŒæœåŠ¡å¦‚æ­¤ç¼“æ…¢</a></li><li><a href=#111-zones>1.11 Zones</a></li><li><a href=#112-åˆ·æ–°eurekaå®¢æˆ·ç«¯>1.12 åˆ·æ–°Eurekaå®¢æˆ·ç«¯</a></li><li><a href=#113-ä½¿ç”¨springcloudè´Ÿè½½å‡è¡¡çš„eureka>1.13 ä½¿ç”¨SpringCloudè´Ÿè½½å‡è¡¡çš„Eureka</a></li></ul></li><li><a href=#2-æœåŠ¡å‘ç°eurekaæœåŠ¡ç«¯>2 æœåŠ¡å‘ç°ï¼šEurekaæœåŠ¡ç«¯</a><ul><li><a href=#21-å¦‚ä½•åŒ…å«eurekaæœåŠ¡ç«¯>2.1 å¦‚ä½•åŒ…å«EurekaæœåŠ¡ç«¯</a></li><li><a href=#22-å¦‚ä½•è¿è¡ŒeurekaæœåŠ¡ç«¯>2.2 å¦‚ä½•è¿è¡ŒEurekaæœåŠ¡ç«¯</a></li><li><a href=#23-é«˜å¯ç”¨åŒºåŸŸå’Œåœ°åŒº>2.3 é«˜å¯ç”¨ï¼ŒåŒºåŸŸå’Œåœ°åŒº</a></li><li><a href=#24-ç‹¬ç«‹æ¨¡å¼>2.4 ç‹¬ç«‹æ¨¡å¼</a></li><li><a href=#25-å¯¹ç­‰æ¨¡å¼>2.5 å¯¹ç­‰æ¨¡å¼</a></li><li><a href=#26-ä½•æ—¶é€‰æ‹©ipåœ°å€>2.6 ä½•æ—¶é€‰æ‹©IPåœ°å€</a></li><li><a href=#27-ä¿æŠ¤eurekaæœåŠ¡å™¨>2.7 ä¿æŠ¤EurekaæœåŠ¡å™¨</a></li><li><a href=#28-jdk11æ”¯æŒ>2.8 JDK11æ”¯æŒ</a></li></ul></li><li><a href=#3-é…ç½®å±æ€§>3 é…ç½®å±æ€§</a></li></ul></nav></div></nav><main class="docs-content col-lg-11 col-xl-9"><nav aria-label=breadcrumb><ol class=breadcrumb><li class=breadcrumb-item><a href=https://www.springcloud.io/>Home</a></li><li class=breadcrumb-item><a href=https://www.springcloud.io/docs/>Docs</a></li><li class=breadcrumb-item><a href=https://www.springcloud.io/docs/springcloud/>SpringCloud</a></li><li class="breadcrumb-item active" aria-current=page>Spring Cloud Netflix</li></ol></nav><h1>Spring Cloud Netflix</h1><p class=lead></p><ul><li>å½“å‰ç‰ˆæœ¬ï¼š3.0.3</li><li>ä¿®æ”¹æ—¶é—´ï¼š2021å¹´7æœˆ22æ—¥</li><li>å®˜æ–¹æ–‡æ¡£ï¼š<a href=https://docs.spring.io/spring-cloud-netflix/docs/current/reference/html/>https://docs.spring.io/spring-cloud-netflix/docs/current/reference/html/</a></li><li>æºç ä»“åº“ï¼š<a href=https://github.com/spring-cloud/spring-cloud-netflix>https://github.com/spring-cloud/spring-cloud-netflix</a></li></ul><p>Spring Cloud Netflixé€šè¿‡è‡ªåŠ¨é…ç½®å’Œç»‘å®šåˆ°Springç¯å¢ƒå’Œå…¶ä»–Springç¼–ç¨‹æ¨¡å‹ä¹ è¯­ï¼Œä¸ºSpring Bootåº”ç”¨æä¾›äº†Netflix OSSé›†æˆã€‚é€šè¿‡ä¸€äº›ç®€å•çš„æ³¨é‡Šï¼Œæ‚¨å¯ä»¥åœ¨åº”ç”¨ç¨‹åºä¸­å¿«é€Ÿå¯ç”¨å’Œé…ç½®é€šç”¨æ¨¡å¼ï¼Œå¹¶ä½¿ç”¨ç»è¿‡å®æˆ˜è€ƒéªŒçš„Netflixç»„ä»¶æ„å»ºå¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿã€‚æä¾›çš„æ¨¡å¼åŒ…æ‹¬æœåŠ¡å‘ç°(Eureka)ã€æ–­è·¯å™¨(Hystrix)ã€æ™ºèƒ½è·¯ç”±(Zuul)å’Œå®¢æˆ·ç«¯è´Ÿè½½å‡è¡¡(Ribbon)ã€‚</p><h2 id=1-æœåŠ¡å‘ç°eurekaå®¢æˆ·ç«¯>1 æœåŠ¡å‘ç°ï¼šEurekaå®¢æˆ·ç«¯<a href=#1-æœåŠ¡å‘ç°eurekaå®¢æˆ·ç«¯ class=anchor aria-hidden=true>#</a></h2><p>æœåŠ¡å‘ç°æ˜¯åŸºäºå¾®æœåŠ¡çš„ä½“ç³»ç»“æ„çš„å…³é”®åŸåˆ™ä¹‹ä¸€ã€‚å°è¯•æ‰‹åŠ¨é…ç½®æ¯ä¸ªå®¢æˆ·ç«¯æˆ–æŸç§å½¢å¼çš„çº¦å®šå¯èƒ½å¾ˆå›°éš¾ï¼Œè€Œä¸”å¯èƒ½æ˜“æŒ‚ã€‚Netflixçš„æœåŠ¡å‘ç°å™¨å’Œå®¢æˆ·ç«¯Eurekaï¼Œå¯ä»¥å°†æœåŠ¡å™¨é…ç½®å’Œéƒ¨ç½²ä¸ºé«˜å¯ç”¨æ€§ï¼Œæ¯ä¸ªæœåŠ¡å™¨éƒ½å¯ä»¥å°†å·²æ³¨å†ŒæœåŠ¡çš„çŠ¶æ€å¤åˆ¶ç»™å…¶ä»–æœåŠ¡å™¨ã€‚</p><h3 id=11-å¦‚ä½•å¼•å…¥eurekaå®¢æˆ·ç«¯>1.1 å¦‚ä½•å¼•å…¥Eurekaå®¢æˆ·ç«¯<a href=#11-å¦‚ä½•å¼•å…¥eurekaå®¢æˆ·ç«¯ class=anchor aria-hidden=true>#</a></h3><p>è¦åœ¨é¡¹ç›®ä¸­åŒ…å«Eureaka Clientï¼Œè¯·ä½¿ç”¨startä¸­gruop IDä¸º<code>org.springframework.cloud</code>å’Œartifact IDä¸º<code>spring-cloud-starter-netflix-eureka-client</code>çš„åŒ…ï¼Œæœ‰å…³ä½¿ç”¨Spring cloudè®¾ç½®æ„å»ºç³»ç»Ÿçš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href=https://spring.io/projects/spring-cloud>Spring Cloud Project</a>
é¡µé¢ã€‚</p><h3 id=12-å‘eurekaæ³¨å†ŒæœåŠ¡>1.2 å‘Eurekaæ³¨å†ŒæœåŠ¡<a href=#12-å‘eurekaæ³¨å†ŒæœåŠ¡ class=anchor aria-hidden=true>#</a></h3><p>å½“å®¢æˆ·ç«¯å‘Eurekaæ³¨å†Œæ—¶ï¼Œå®ƒä¼šæä¾›å…³äºè‡ªèº«çš„å…ƒæ•°æ®ï¼Œä¾‹å¦‚ä¸»æœºã€ç«¯å£ã€å¥åº·çŠ¶æ€URlã€ä¸»é¡µå’Œå…¶ä»–è¯¦ç»†ä¿¡æ¯ã€‚Eurekaæ¥æ”¶æ¥è‡ªå±äºæŸä¸ªæœåŠ¡çš„æ¯ä¸ªå®ä¾‹çš„å¿ƒè·³æ¶ˆæ¯ã€‚å¦‚æœåœ¨å¯é…ç½®çš„æ—¶é—´å†…æ£€æµ‹å¿ƒè·³å¤±è´¥ï¼Œå®ä¾‹å®¢æˆ·ç«¯é€šå¸¸ä¼šä»æ³¨å†Œä¸­å¿ƒåˆ é™¤ã€‚</p><p>ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†ä¸€ä¸ªæœ€å°çš„Eurekaå®¢æˆ·ç«¯åº”ç”¨ç¨‹åº:</p><div class=highlight><pre class=chroma><code class=language-java data-lang=java><span class=nd>@SpringBootApplication</span>
<span class=nd>@RestController</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Application</span> <span class=o>{</span>

    <span class=nd>@RequestMapping</span><span class=o>(</span><span class=s>&#34;/&#34;</span><span class=o>)</span>
    <span class=kd>public</span> <span class=n>String</span> <span class=nf>home</span><span class=o>()</span> <span class=o>{</span>
        <span class=k>return</span> <span class=s>&#34;Hello world&#34;</span><span class=o>;</span>
    <span class=o>}</span>

    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>new</span> <span class=n>SpringApplicationBuilder</span><span class=o>(</span><span class=n>Application</span><span class=o>.</span><span class=na>class</span><span class=o>).</span><span class=na>web</span><span class=o>(</span><span class=kc>true</span><span class=o>).</span><span class=na>run</span><span class=o>(</span><span class=n>args</span><span class=o>);</span>
    <span class=o>}</span>

<span class=o>}</span>
</code></pre></div><p>æ³¨æ„ï¼Œä¸Šé¢çš„ç¤ºä¾‹åªæ˜¯ä¸€ä¸ªæ™®é€šçš„Spring Bootåº”ç”¨ç¨‹åºã€‚é€šè¿‡åŒ…ç®¡ç†æ–‡ä»¶å¼•å…¥<code>spring-cloud-starter-netflix-Eureka-client</code>ä¾èµ–ï¼Œä½ çš„åº”ç”¨ç¨‹åºå°†è‡ªåŠ¨æ³¨å†Œåˆ°Eureka Serverã€‚å®šä½ EurekaæœåŠ¡å™¨éœ€è¦é…ç½®ï¼Œå¦‚ä¸‹é¢çš„ä¾‹å­æ‰€ç¤º:</p><p><strong>application.yml</strong></p><div class=highlight><pre class=chroma><code class=language-yml data-lang=yml><span class=nt>eureka</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>client</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>serviceUrl</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>defaultZone</span><span class=p>:</span><span class=w> </span><span class=l>http://localhost:8761/eureka/</span><span class=w>
</span></code></pre></div><p>åœ¨å‰é¢çš„ç¤ºä¾‹ä¸­ï¼Œ<code>defaultZone</code> æ˜¯ä¸€ä¸ªç¼ºçœå­—ç¬¦ä¸²å›è°ƒå€¼ï¼Œå®ƒä¸ºä»»ä½•ä¸å¡«å†™æ³¨å†Œä¸­å¿ƒåœ°å€çš„å®¢æˆ·ç«¯æä¾›ä¸€ä¸ªé»˜è®¤å€¼ã€‚(æ¢å¥è¯è¯´ï¼šä¸å¡«æ­¤é¡¹ï¼Œeurekaä½¿ç”¨http://localhost:8761/eureka/ä½œä¸ºé»˜è®¤åœ°å€)</p><blockquote><p>ğŸ“ è¿™ä¸ª<code>defaultZone</code>å±æ€§æ˜¯åŒºåˆ†å¤§å°å†™çš„ï¼Œå¹¶ä¸”éœ€è¦é©¼å³°å‘½ä»¤æ³•ï¼Œå› ä¸º<code>serviceUrl</code>å±æ€§æ˜¯<code>Map&lt;String, String></code>ã€‚å› æ­¤ï¼Œ<code>defaultZone</code>å±æ€§ä¸éµå¾ªå¸¸è§„Spring Bootè›‡å½¢å‘½åæ³•çº¦å®šã€‚</p></blockquote><p>é»˜è®¤çš„åº”ç”¨ç¨‹åºåç§°(å³æœåŠ¡ ID)ã€è™šæ‹Ÿä¸»æœºå’Œéå®‰å…¨ç«¯å£(å–è‡ªç¯å¢ƒ)åˆ†åˆ«ä¸º<code>${ spring.application.name }</code>ã€<code>${ spring.application.name }</code>å’Œ<code>${ server.port }</code>ã€‚</p><p>åœ¨åŒ…ç®¡ç†å·¥å…·ä¸­å¼•å…¥<code>spring-cloud-starter-netflix-Eureka-client</code>,ä½¿å¾—åº”ç”¨ç¨‹åºæ—¢æˆä¸ºEurekaç¤ºä¾‹ï¼Œä¹Ÿæˆä¸ºå®¢æˆ·ç«¯ï¼ˆå®ƒå¯ä»¥æŸ¥è¯¢æ³¨å†Œä¸­å¿ƒå®šä½å…¶ä»–æœåŠ¡ï¼‰ã€‚å®ä¾‹è¡Œä¸ºæ˜¯ç”±<code>euraka.instance.*</code>é…ç½®é©±åŠ¨çš„ï¼Œä½†æ˜¯ä½ è¦ç¡®ä¿ä½ çš„åº”ç”¨ç¨‹åºé…ç½®<code>spring.application.name</code>å€¼ã€‚</p><blockquote><p>æœ‰å…³å¯é…ç½®é€‰é¡¹çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…<a href=https://github.com/spring-cloud/spring-cloud-netflix/tree/main/spring-cloud-netflix-eureka-client/src/main/java/org/springframework/cloud/netflix/eureka/EurekaInstanceConfigBean.java>EurekaInstanceConfigBean</a>å’Œ<a href=https://github.com/spring-cloud/spring-cloud-netflix/tree/main/spring-cloud-netflix-eureka-client/src/main/java/org/springframework/cloud/netflix/eureka/EurekaClientConfigBean.java>EurekaClientConfigBean</a>ã€‚</p></blockquote><p>è¦ç¦ç”¨Eurekaå‘ç°å®¢æˆ·ç«¯ï¼Œä½ å¯ä»¥å°†<code>Eureka.Client.enabled</code>è®¾ç½®ä¸º<code>false</code>ã€‚å½“ <code>spring.cloud.Discovery.enabled</code>è®¾ç½®ä¸º<code>false</code>æ—¶ï¼ŒEurekaå‘ç°å®¢æˆ·ç«¯ä¹Ÿå°†è¢«ç¦ç”¨ã€‚</p><h3 id=13-åœ¨eurekaæœåŠ¡ç«¯ä¸ŠéªŒè¯>1.3 åœ¨EurekaæœåŠ¡ç«¯ä¸ŠéªŒè¯<a href=#13-åœ¨eurekaæœåŠ¡ç«¯ä¸ŠéªŒè¯ class=anchor aria-hidden=true>#</a></h3><p>å¦‚æœ<code>eureka.client.serviceur.defaultzone</code>çš„Urlä¸­åµŒå…¥äº†å‡­æ®(curlæ ·å¼çš„ï¼Œç¤ºä¾‹ï¼šuser: password@localhost: 8761/eureka)ï¼ŒHTTPçš„åŸºæœ¬èº«ä»½éªŒè¯å°†è‡ªåŠ¨æ·»åŠ åˆ°Eurekaå®¢æˆ·æœºä¸­ã€‚å¯¹äºæ›´è´Ÿè½½çš„éœ€æ±‚ï¼Œä½ å¯ä»¥åˆ›å»ºç±»å‹ä¸ºï¼š<code>DiscoveryClientOptionalArgs</code> çš„<code>@bean</code>ï¼Œå¹¶å°†<code>ClientFilter</code>å®ä¾‹æ’å…¥å…¶ä¸­ï¼Œæ‰€æœ‰è¿™äº›éƒ½åº”ç”¨äºä»å®¢æˆ·æœºåˆ°æœåŠ¡å™¨çš„è°ƒç”¨ã€‚</p><p>å½“EurekaæœåŠ¡å™¨éœ€è¦å®¢æˆ·ç«¯è¯ä¹¦è¿›è¡Œèº«ä»½éªŒè¯æ—¶ï¼Œå®¢æˆ·ç«¯è¯ä¹¦å’Œä¿¡ä»»å­˜å‚¨å¯ä»¥é€šè¿‡å±æ€§è¿›è¡Œé…ç½®ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤º:</p><p><strong>application.yml</strong></p><div class=highlight><pre class=chroma><code class=language-yml data-lang=yml><span class=nt>eureka</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>client</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>tls</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span><span class=w>      </span><span class=nt>key-store</span><span class=p>:</span><span class=w> </span><span class=l>&lt;path-of-key-store&gt;</span><span class=w>
</span><span class=w>      </span><span class=nt>key-store-type</span><span class=p>:</span><span class=w> </span><span class=l>PKCS12</span><span class=w>
</span><span class=w>      </span><span class=nt>key-store-password</span><span class=p>:</span><span class=w> </span><span class=l>&lt;key-store-password&gt;</span><span class=w>
</span><span class=w>      </span><span class=nt>key-password</span><span class=p>:</span><span class=w> </span><span class=l>&lt;key-password&gt;</span><span class=w>
</span><span class=w>      </span><span class=nt>trust-store</span><span class=p>:</span><span class=w> </span><span class=l>&lt;path-of-trust-store&gt;</span><span class=w>
</span><span class=w>      </span><span class=nt>trust-store-type</span><span class=p>:</span><span class=w> </span><span class=l>PKCS12</span><span class=w>
</span><span class=w>      </span><span class=nt>trust-store-password</span><span class=p>:</span><span class=w> </span><span class=l>&lt;trust-store-password&gt;</span><span class=w>
</span></code></pre></div><p>å¯ç”¨<code>Eureka.client.TLS.enabled </code>è¦ä¸ºtrueæ‰èƒ½å¯ç”¨Eurekaå®¢æˆ·ç«¯çš„TLSã€‚å½“çœç•¥<code>eurea.client.tls.trust-store</code>æ—¶ï¼Œå°†ä½¿ç”¨JVMé»˜è®¤ä¿¡ä»»å­˜å‚¨ã€‚<code>Eureka.client.tls.key-store-type</code>å’Œ<code>eureka.client.tls.trust-store-type</code>çš„é»˜è®¤å€¼æ˜¯ PKCS12ã€‚å¦‚æœçœç•¥å¯†ç å±æ€§ï¼Œåˆ™å‡å®šä¸ºç©ºå¯†ç ã€‚</p><blockquote><p>ç”±äº Eureka ä¸­çš„é™åˆ¶ï¼Œä¸å¯èƒ½æ”¯æŒæ¯ä¸ªæœåŠ¡å™¨çš„åŸºæœ¬æˆæƒå‡­è¯ï¼Œå› æ­¤åªä½¿ç”¨æ‰¾åˆ°çš„ç¬¬ä¸€ç»„å‡­è¯ã€‚</p></blockquote><p>å¦‚æœä½ æƒ³å®šåˆ¶Eureka HTTPå®¢æˆ·ç«¯ä½¿ç”¨çš„<code>RestTemplate</code>ï¼Œä½ å¯ä»¥åˆ›å»ºä¸€ä¸ª <code>EurekaClientHttpRequestFactorySupplier</code>ï¼Œå¹¶ç¼–å†™è‡ªå·±çš„é€»è¾‘æ¥ç”Ÿæˆ<code>ClientHttpRequestFactory</code>å®ä¾‹ã€‚</p><h3 id=14-çŠ¶æ€é¡µå’Œå¥åº·æŒ‡ç¤ºå™¨>1.4 çŠ¶æ€é¡µå’Œå¥åº·æŒ‡ç¤ºå™¨<a href=#14-çŠ¶æ€é¡µå’Œå¥åº·æŒ‡ç¤ºå™¨ class=anchor aria-hidden=true>#</a></h3><p>Eureka å®ä¾‹çš„çŠ¶æ€é¡µé¢å’Œå¥åº·çŠ¶æ€æŒ‡ç¤ºå™¨åˆ†åˆ«é»˜è®¤ä¸º<code>/info</code> å’Œ<code>/health</code>ï¼Œè¿™æ˜¯Spring Boot Actuatoråº”ç”¨ç¨‹åºä¸­æœ‰ç”¨çš„ç«¯ç‚¹é»˜è®¤ä½ç½®ã€‚å¦‚æœä½¿ç”¨éé»˜è®¤çš„ä¸Šä¸‹æ–‡è·¯å¾„æˆ–servletè·¯å¾„(æ¯”å¦‚ server.servletPath =/custom) ï¼Œé‚£ä¹ˆå³ä½¿å¯¹äºå®ç°çš„åº”ç”¨ç¨‹åºä¹Ÿéœ€è¦ä¿®æ”¹è¿™äº›è·¯å¾„ã€‚ä¸‹é¢çš„ç¤ºä¾‹æ˜¾ç¤ºäº†è¿™ä¸¤ä¸ªè®¾ç½®çš„é»˜è®¤å€¼:</p><p><strong>application.yml</strong></p><div class=highlight><pre class=chroma><code class=language-yml data-lang=yml><span class=nt>eureka</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>instance</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>statusPageUrlPath</span><span class=p>:</span><span class=w> </span><span class=l>${server.servletPath}/info</span><span class=w>
</span><span class=w>    </span><span class=nt>healthCheckUrlPath</span><span class=p>:</span><span class=w> </span><span class=l>${server.servletPath}/health</span><span class=w>
</span></code></pre></div><p>è¿™äº›é“¾æ¥æ˜¾ç¤ºåœ¨å®¢æˆ·ç«¯ä½¿ç”¨çš„å…ƒæ•°æ®ä¸­ï¼Œå¹¶ä¸”åœ¨æŸäº›åœºæ™¯ä¸­ç”¨äºå†³å®šæ˜¯å¦å‘åº”ç”¨ç¨‹åºå‘é€è¯·æ±‚ï¼Œå› æ­¤å¦‚æœè¿™äº›è¯·æ±‚æ˜¯å‡†ç¡®çš„ï¼Œå°±å¾ˆæœ‰å¸®åŠ©ã€‚</p><blockquote><p>åœ¨Dalston(ç‰ˆæœ¬åå­—)ä¸­ï¼Œå½“æ›´æ”¹ç®¡ç†ä¸Šä¸‹æ–‡è·¯å¾„æ—¶ï¼Œè¿˜éœ€è¦è®¾ç½®çŠ¶æ€å’Œè¿è¡ŒçŠ¶å†µæ£€æŸ¥urlã€‚è¿™ä¸ªè¦æ±‚ä»Edgwareå¼€å§‹å°±è¢«åˆ é™¤äº†</p></blockquote><h3 id=15-æ³¨å†Œå®‰å…¨çš„åº”ç”¨ç¨‹åº>1.5 æ³¨å†Œå®‰å…¨çš„åº”ç”¨ç¨‹åº<a href=#15-æ³¨å†Œå®‰å…¨çš„åº”ç”¨ç¨‹åº class=anchor aria-hidden=true>#</a></h3><p>å¦‚æœä½ çš„åº”ç”¨ç¨‹åºå¸Œæœ›é€šè¿‡ HTTPS è¿›è¡Œè”ç³»ï¼Œå¯ä»¥åœ¨EurekaInstanceConfigBean ä¸­è®¾ç½®ä¸¤ä¸ªå±æ€§:</p><ul><li><code>Eureka.instance.[nonsecurtenabled]=[false]</code></li><li><code>Eureka.instance.[securePortEnabled]=[true]</code></li></ul><p>è¿™æ ·åšä½¿Eurekaå‘å¸ƒçš„å®ä¾‹ä¿¡æ¯æ˜¾ç¤ºäº†å¯¹å®‰å…¨é€šä¿¡çš„æ˜ç¡®åå¥½ã€‚Spring Cloud <code>DiscoveryClient</code> æ€»æ˜¯è¿”å›ä¸€ä¸ªä»¥ httpså¼€å¤´çš„ URIï¼Œç”¨äºä»¥è¿™ç§æ–¹å¼é…ç½®çš„æœåŠ¡ã€‚ç±»ä¼¼åœ°ï¼Œå½“ä»¥è¿™ç§æ–¹å¼é…ç½®æœåŠ¡æ—¶ï¼ŒEureka (æœ¬æœº)å®ä¾‹ä¿¡æ¯å…·æœ‰ä¸€ä¸ªå®‰å…¨çš„å¥åº·æ£€æŸ¥ URLã€‚</p><p>ç”±äºEurekaå†…éƒ¨çš„å·¥ä½œæ–¹å¼ï¼Œå®ƒä»ç„¶ä¸ºçŠ¶æ€å’Œä¸»é¡µå‘å¸ƒä¸€ä¸ªä¸å®‰å…¨çš„URLï¼Œé™¤éä½ ä¹Ÿæ˜¾å¼åœ°è¦†ç›–è¿™äº›å†…å®¹ã€‚ä½ å¯ä»¥ä½¿ç”¨å ä½ç¬¦æ¥é…ç½®eurekaå®ä¾‹ urlï¼Œå¦‚ä¸‹é¢çš„ä¾‹å­æ‰€ç¤º:</p><p><strong>application.yml</strong></p><div class=highlight><pre class=chroma><code class=language-yml data-lang=yml><span class=nt>eureka</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>instance</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>statusPageUrl</span><span class=p>:</span><span class=w> </span><span class=l>https://${eureka.hostname}/info</span><span class=w>
</span><span class=w>    </span><span class=nt>healthCheckUrl</span><span class=p>:</span><span class=w> </span><span class=l>https://${eureka.hostname}/health</span><span class=w>
</span><span class=w>    </span><span class=nt>homePageUrl</span><span class=p>:</span><span class=w> </span><span class=l>https://${eureka.hostname}/</span><span class=w>
</span></code></pre></div><p>(æ³¨æ„ <code>${Eureka.hostname}</code>æ˜¯ä¸€ä¸ªæœ¬æœºå ä½ç¬¦ï¼Œåªèƒ½åœ¨ Eureka çš„åç»­ç‰ˆæœ¬ä¸­ä½¿ç”¨ã€‚å¯¹äºSpringå ä½ç¬¦ä¹Ÿå¯ä»¥å®ç°åŒæ ·çš„åŠŸèƒ½ãƒ¼ãƒ¼ä¾‹å¦‚ï¼Œä½¿ç”¨ <code>${eureka.instance.hostname}</code>.)</p><blockquote><p>å¦‚æœä½ çš„åº”ç”¨ç¨‹åºè¿è¡Œåœ¨ä»£ç†ä¹‹åï¼Œå¹¶ä¸”SSLç»ˆæ­¢åœ¨ä»£ç†ä¸­(ä¾‹å¦‚ï¼Œå¦‚æœä½ ä½œä¸ºæœåŠ¡è¿è¡Œåœ¨Cloud Foundryæˆ–å…¶ä»–å¹³å°ä¸Š) ï¼Œç„¶åï¼Œä½ éœ€è¦ç¡®ä¿â€œè½¬å‘â€çš„ä»£ç†å¤´è¢«åº”ç”¨ç¨‹åºæ‹¦æˆªå’Œå¤„ç†ã€‚å¦‚æœåœ¨Spring Bootåº”ç”¨ç¨‹åºä¸­åµŒå…¥çš„Tomcatå®¹å™¨å¯¹&rsquo;X-Forwarded-* &lsquo;å¤´æœ‰æ˜¾å¼é…ç½®ï¼Œè¿™å°†è‡ªåŠ¨ç”Ÿæ•ˆã€‚åº”ç”¨ç¨‹åºå‘ˆç°ç»™è‡ªèº«çš„é“¾æ¥æ˜¯é”™è¯¯çš„(é”™è¯¯çš„ä¸»æœºã€ç«¯å£æˆ–åè®®)ï¼Œè¿™æ˜¯é…ç½®é”™è¯¯çš„æ ‡å¿—ã€‚</p></blockquote><h3 id=16-eurekaçš„å¥åº·æ£€æŸ¥>1.6 Eurekaçš„å¥åº·æ£€æŸ¥<a href=#16-eurekaçš„å¥åº·æ£€æŸ¥ class=anchor aria-hidden=true>#</a></h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼ŒEurekaä½¿ç”¨å®¢æˆ·ç«¯å¿ƒè·³æ¥ç¡®å®šå®¢æˆ·ç«¯æ˜¯å¦å¯åŠ¨ã€‚é™¤éå¦è¡ŒæŒ‡å®šï¼Œå¦åˆ™å‘ç°å®¢æˆ·ç«¯ä¸ä¼šæ ¹æ®Spring Bootæ‰§è¡Œå™¨ä¼ æ’­åº”ç”¨ç¨‹åºçš„å½“å‰è¿è¡ŒçŠ¶å†µæ£€æŸ¥çŠ¶æ€ã€‚å› æ­¤ï¼Œåœ¨æˆåŠŸæ³¨å†Œåï¼ŒEurekaæ€»æ˜¯å®£å¸ƒåº”ç”¨ç¨‹åºå¤„äº<code>UP</code>çŠ¶æ€ã€‚å¯ä»¥é€šè¿‡å¯ç”¨Eurekaè¿è¡ŒçŠ¶å†µæ£€æŸ¥æ¥æ›´æ”¹æ­¤è¡Œä¸ºï¼Œè¿™å°†å¯¼è‡´å°†åº”ç”¨ç¨‹åºçŠ¶æ€ä¼ æ’­åˆ°Eurekaã€‚å› æ­¤ï¼Œæ¯ä¸ªå…¶ä»–åº”ç”¨ç¨‹åºä¸ä¼šå‘å¤„äº<code>UP</code>çŠ¶æ€ä»¥å¤–çš„åº”ç”¨ç¨‹åºå‘é€æµé‡ã€‚ä¸‹é¢çš„ç¤ºä¾‹æ˜¾ç¤ºå¦‚ä½•ä¸ºå®¢æˆ·ç«¯å¯ç”¨è¿è¡ŒçŠ¶å†µæ£€æŸ¥ã€‚</p><p><strong>application.yml</strong></p><div class=highlight><pre class=chroma><code class=language-yml data-lang=yml><span class=nt>eureka</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>client</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>healthcheck</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>enabled</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></code></pre></div><blockquote><p><code>eureka.client.healthcheck.enabled=true</code>åº”è¯¥åªåœ¨<code>application.yml</code>ä¸­è®¾ç½®ã€‚åœ¨<code>bootstrap.yml</code>ä¸­è®¾ç½®è¿™ä¸ªå€¼ä¼šå¼•èµ·ä¸å¥½çš„å‰¯ä½œç”¨ã€‚ä¾‹å¦‚åœ¨Eurekaä»¥<code>UNKNOWN</code>çŠ¶æ€æ³¨å†Œã€‚</p></blockquote><p>å¦‚æœä½ éœ€è¦å¯¹è¿è¡ŒçŠ¶å†µæ£€æŸ¥è¿›è¡Œæ›´å¤šçš„æ§åˆ¶ï¼Œå¯ä»¥è€ƒè™‘å®ç°è‡ªå·±çš„æ£€æŸ¥<code>com.netflix.appinfo.HealthCheckHandler</code>ã€‚</p><h3 id=17-eurekaå®¢æˆ·ç«¯å’Œå®ä¾‹çš„å…ƒæ•°æ®>1.7 Eurekaå®¢æˆ·ç«¯å’Œå®ä¾‹çš„å…ƒæ•°æ®<a href=#17-eurekaå®¢æˆ·ç«¯å’Œå®ä¾‹çš„å…ƒæ•°æ® class=anchor aria-hidden=true>#</a></h3><p>èŠ±ç‚¹æ—¶é—´äº†è§£Eurekaå…ƒæ•°æ®æ˜¯å¦‚ä½•å·¥ä½œçš„æ˜¯å€¼å¾—çš„ï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥åœ¨æ‚¨çš„å¹³å°ä¸Šä»¥ä¸€ç§æœ‰æ„ä¹‰çš„æ–¹å¼ä½¿ç”¨å®ƒã€‚å¯¹äºä¸»æœºåã€IPåœ°å€ã€ç«¯å£å·ã€çŠ¶æ€é¡µå’Œå¥åº·æ£€æŸ¥ç­‰ä¿¡æ¯ï¼Œæœ‰æ ‡å‡†çš„å…ƒæ•°æ®ã€‚è¿™äº›ä¿¡æ¯å‘å¸ƒåœ¨æœåŠ¡æ³¨å†Œä¸­å¿ƒä¸­ï¼Œå®¢æˆ·ç«¯ä½¿ç”¨å®ƒä»¬ä»¥ä¸€ç§ç®€å•çš„æ–¹å¼è”ç³»æœåŠ¡ã€‚é™„åŠ çš„å…ƒæ•°æ®å¯ä»¥æ·»åŠ åˆ°å®ä¾‹æ³¨å†Œçš„<code>eureka.instance.metadataMap</code>ä¸­ï¼Œè¯¥å…ƒæ•°æ®å¯ä»¥åœ¨è¿œç¨‹å®¢æˆ·æœºä¸­è®¿é—®ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œé™„åŠ çš„å…ƒæ•°æ®ä¸ä¼šæ”¹å˜å®¢æˆ·æœºçš„è¡Œä¸ºï¼Œé™¤éå®¢æˆ·æœºçŸ¥é“å…ƒæ•°æ®çš„å«ä¹‰ã€‚åœ¨ä¸€äº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼ŒSpring Cloudå·²ç»ä¸ºå…ƒæ•°æ®æ˜ å°„èµ‹äºˆäº†æ„ä¹‰ï¼Œæœ¬æ–‡ç¨åå°†å¯¹æ­¤è¿›è¡Œæè¿°ã€‚</p><h4 id=171-åœ¨cloud-foundryä¸Šä½¿ç”¨eureka>1.7.1 åœ¨Cloud Foundryä¸Šä½¿ç”¨Eureka<a href=#171-åœ¨cloud-foundryä¸Šä½¿ç”¨eureka class=anchor aria-hidden=true>#</a></h4><p>Cloud Foundryæœ‰ä¸€ä¸ªå…¨å±€è·¯ç”±å™¨ï¼Œè¿™æ ·åŒä¸€ä¸ªåº”ç”¨çš„æ‰€æœ‰å®ä¾‹éƒ½æœ‰ç›¸åŒçš„ä¸»æœºå(å…¶ä»–å…·æœ‰ç±»ä¼¼æ¶æ„çš„PaaSè§£å†³æ–¹æ¡ˆä¹Ÿæœ‰ç›¸åŒçš„å®‰æ’)ã€‚è¿™å¹¶ä¸ä¸€å®šæ˜¯ä½¿ç”¨Eurekaçš„éšœç¢ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ ä½¿ç”¨è·¯ç”±å™¨(å»ºè®®æˆ–å¼ºåˆ¶ä½¿ç”¨ï¼Œè¿™å–å†³äºå¹³å°çš„è®¾ç½®æ–¹å¼)ï¼Œåˆ™éœ€è¦æ˜¾å¼è®¾ç½®ä¸»æœºåå’Œç«¯å£å·(å®‰å…¨æˆ–ä¸å®‰å…¨)ï¼Œä»¥ä¾¿å®ƒä»¬ä½¿ç”¨è·¯ç”±å™¨ã€‚ä½ å¯èƒ½è¿˜å¸Œæœ›ä½¿ç”¨å®ä¾‹å…ƒæ•°æ®ï¼Œä»¥ä¾¿èƒ½å¤ŸåŒºåˆ†å®¢æˆ·æœºä¸Šçš„å®ä¾‹(ä¾‹å¦‚ï¼Œåœ¨è‡ªå®šä¹‰è´Ÿè½½å¹³è¡¡å™¨ä¸­)ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>eureka.instance.instanceId</code>æ˜¯<code>vcap.application.Instance_id</code>ï¼Œç¤ºä¾‹å¦‚ä¸‹:</p><p><strong>application.yml</strong></p><div class=highlight><pre class=chroma><code class=language-yml data-lang=yml><span class=nt>eureka</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>instance</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>hostname</span><span class=p>:</span><span class=w> </span><span class=l>${vcap.application.uris[0]}</span><span class=w>
</span><span class=w>    </span><span class=nt>nonSecurePort</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></code></pre></div><p>æ ¹æ®åœ¨Cloud Foundryå®ä¾‹ä¸­è®¾ç½®å®‰å…¨è§„åˆ™çš„æ–¹å¼ï¼Œæ‚¨èƒ½å¤Ÿæ³¨å†Œå¹¶ä½¿ç”¨ä¸»æœºVMçš„IPåœ°å€æ¥è¿›è¡Œç›´æ¥çš„æœåŠ¡åˆ°æœåŠ¡è°ƒç”¨ã€‚è¿™ä¸ªç‰¹æ€§åœ¨å…³é”®çš„WebæœåŠ¡(PWS)ä¸Šè¿˜ä¸å¯ç”¨ã€‚</p><h3 id=172-åœ¨awsä¸Šä½¿ç”¨eureka>1.7.2 åœ¨AWSä¸Šä½¿ç”¨Eureka<a href=#172-åœ¨awsä¸Šä½¿ç”¨eureka class=anchor aria-hidden=true>#</a></h3><p>å¦‚æœè®¡åˆ’å°†åº”ç”¨éƒ¨ç½²åˆ°AWSäº‘ï¼Œåˆ™å¿…é¡»å°†Eurekaå®ä¾‹é…ç½®ä¸ºAWSæ„ŸçŸ¥ã€‚ä½ å¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼å®šåˆ¶<code>EurekaInstanceConfigBean</code>:</p><div class=highlight><pre class=chroma><code class=language-java data-lang=java><span class=nd>@Bean</span>
<span class=nd>@Profile</span><span class=o>(</span><span class=s>&#34;!default&#34;</span><span class=o>)</span>
<span class=kd>public</span> <span class=n>EurekaInstanceConfigBean</span> <span class=nf>eurekaInstanceConfig</span><span class=o>(</span><span class=n>InetUtils</span> <span class=n>inetUtils</span><span class=o>)</span> <span class=o>{</span>
  <span class=n>EurekaInstanceConfigBean</span> <span class=n>bean</span> <span class=o>=</span> <span class=k>new</span> <span class=n>EurekaInstanceConfigBean</span><span class=o>(</span><span class=n>inetUtils</span><span class=o>);</span>
  <span class=n>AmazonInfo</span> <span class=n>info</span> <span class=o>=</span> <span class=n>AmazonInfo</span><span class=o>.</span><span class=na>Builder</span><span class=o>.</span><span class=na>newBuilder</span><span class=o>().</span><span class=na>autoBuild</span><span class=o>(</span><span class=s>&#34;eureka&#34;</span><span class=o>);</span>
  <span class=n>bean</span><span class=o>.</span><span class=na>setDataCenterInfo</span><span class=o>(</span><span class=n>info</span><span class=o>);</span>
  <span class=k>return</span> <span class=n>bean</span><span class=o>;</span>
<span class=o>}</span>
</code></pre></div><h3 id=173-ä¿®æ”¹eurekaçš„å®ä¾‹id>1.7.3 ä¿®æ”¹Eurekaçš„å®ä¾‹ID<a href=#173-ä¿®æ”¹eurekaçš„å®ä¾‹id class=anchor aria-hidden=true>#</a></h3><p>ä¸€ä¸ªæ™®é€šçš„Netflix Eurekaå®ä¾‹æ˜¯ç”¨ä¸€ä¸ªä¸å®ƒçš„ä¸»æœºåç›¸ç­‰çš„IDæ³¨å†Œçš„(ä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸ªä¸»æœºåªæœ‰ä¸€ä¸ªæœåŠ¡)ã€‚Spring Cloud Eurekaæä¾›äº†ä¸€ä¸ªåˆç†çš„é»˜è®¤å€¼ï¼Œå®šä¹‰å¦‚ä¸‹:
<code>${spring.cloud.client.hostname}:${spring.application.name}:${spring.application.instance_id:${server.port}}</code></p><p>ä¸€ä¸ªä¾‹å­æ˜¯ï¼š<code>myhost:myappname:8080</code>ã€‚
é€šè¿‡ä½¿ç”¨Spring Cloudï¼Œæ‚¨å¯ä»¥é€šè¿‡åœ¨<code>eureka.instance.instanceId</code>ä¸­æä¾›å”¯ä¸€çš„æ ‡è¯†ç¬¦æ¥è¦†ç›–è¿™ä¸ªå€¼ã€‚ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤º:</p><p><strong>application.yml</strong></p><div class=highlight><pre class=chroma><code class=language-yml data-lang=yml><span class=nt>eureka</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>instance</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>instanceId</span><span class=p>:</span><span class=w> </span><span class=l>${spring.application.name}:${vcap.application.instance_id:${spring.application.instance_id:${random.value}}}</span><span class=w>
</span></code></pre></div><p>ä½¿ç”¨å‰é¢ç¤ºä¾‹ä¸­æ˜¾ç¤ºçš„å…ƒæ•°æ®å’Œéƒ¨ç½²åœ¨localhostä¸Šçš„å¤šä¸ªæœåŠ¡å®ä¾‹ï¼Œå°†æ’å…¥éšæœºå€¼ä»¥ä½¿å®ä¾‹å”¯ä¸€ã€‚åœ¨Cloud Foundryä¸­ï¼Œ<code>vcap.application.instance_id</code>æ˜¯åœ¨Spring Bootåº”ç”¨ç¨‹åºä¸­è‡ªåŠ¨å¡«å……çš„ï¼Œå› æ­¤ä¸éœ€è¦è¿™ä¸ªéšæœºå€¼ã€‚</p><h3 id=18-ä½¿ç”¨eurekaclient>1.8 ä½¿ç”¨EurekaClient<a href=#18-ä½¿ç”¨eurekaclient class=anchor aria-hidden=true>#</a></h3><p>ä¸€æ—¦ä½ æ‹¥æœ‰äº†ä¸€ä¸ªä½œä¸ºå‘ç°å®¢æˆ·ç«¯çš„åº”ç”¨ç¨‹åºï¼Œæ‚¨å°±å¯ä»¥ä½¿ç”¨å®ƒä»<code>Eureka Server</code>å‘ç°æœåŠ¡å®ä¾‹ã€‚ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨æœ¬æœº<code>com.netflix.discovery.EurekaClient</code>(ä¸Spring Cloud DiscoveryClientç›¸å)ï¼Œå¦‚ä¸‹é¢çš„ç¤ºä¾‹æ‰€ç¤ºã€‚</p><div class=highlight><pre class=chroma><code class=language-java data-lang=java><span class=nd>@Autowired</span>
<span class=kd>private</span> <span class=n>EurekaClient</span> <span class=n>discoveryClient</span><span class=o>;</span>

<span class=kd>public</span> <span class=n>String</span> <span class=nf>serviceUrl</span><span class=o>()</span> <span class=o>{</span>
    <span class=n>InstanceInfo</span> <span class=n>instance</span> <span class=o>=</span> <span class=n>discoveryClient</span><span class=o>.</span><span class=na>getNextServerFromEureka</span><span class=o>(</span><span class=s>&#34;STORES&#34;</span><span class=o>,</span> <span class=kc>false</span><span class=o>);</span>
    <span class=k>return</span> <span class=n>instance</span><span class=o>.</span><span class=na>getHomePageUrl</span><span class=o>();</span>
<span class=o>}</span>
</code></pre></div><blockquote><p>ä¸è¦åœ¨<code>@PostConstruct</code>æ–¹æ³•æˆ–<code>@Scheduled</code>æ–¹æ³•ä¸­ä½¿ç”¨<code>eurekclient</code>(æˆ–åœ¨<code>ApplicationContext</code>å¯èƒ½è¿˜æ²¡æœ‰å¯åŠ¨çš„ä»»ä½•åœ°æ–¹)ã€‚å®ƒæ˜¯åœ¨<code>SmartLifecycle</code>ä¸­åˆå§‹åŒ–çš„(<code>phase=0</code>)ï¼Œæ‰€ä»¥ä½ æœ€æ—©å¯ä»¥ä¾èµ–å®ƒæ˜¯åœ¨å¦ä¸€ä¸ªå…·æœ‰æ›´é«˜é˜¶æ®µçš„<code>SmartLifecycle</code>ä¸­ã€‚</p></blockquote><h4 id=181-eurekaclietæ²¡æœ‰jersey>1.8.1 EurekaClietæ²¡æœ‰Jersey<a href=#181-eurekaclietæ²¡æœ‰jersey class=anchor aria-hidden=true>#</a></h4><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œeurekclientä½¿ç”¨Springçš„<code>RestTemplate</code>è¿›è¡ŒHTTPé€šä¿¡ã€‚å¦‚æœæ‚¨å¸Œæœ›ä½¿ç”¨Jerseyï¼Œåˆ™éœ€è¦å°†Jerseyä¾èµ–é¡¹æ·»åŠ åˆ°ç±»è·¯å¾„ä¸­ã€‚ä¸‹é¢çš„ä¾‹å­æ˜¾ç¤ºäº†ä½ éœ€è¦æ·»åŠ çš„åŒ…ç®¡ç†æ–‡ä»¶ä¸­:</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>&lt;dependency&gt;
    &lt;groupId&gt;com.sun.jersey&lt;/groupId&gt;
    &lt;artifactId&gt;jersey-client&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.sun.jersey&lt;/groupId&gt;
    &lt;artifactId&gt;jersey-core&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
    &lt;groupId&gt;com.sun.jersey.contribs&lt;/groupId&gt;
    &lt;artifactId&gt;jersey-apache-client4&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre></div><h3 id=19-æ›¿ä»£åŸç”Ÿnetflix-eurakaclient>1.9 æ›¿ä»£åŸç”ŸNetflix EurakaClient<a href=#19-æ›¿ä»£åŸç”Ÿnetflix-eurakaclient class=anchor aria-hidden=true>#</a></h3><p>ä½ ä¸éœ€è¦ä½¿ç”¨åŸå§‹çš„<code>Netflix eurekclient</code>ã€‚åœ¨æŸç§å°è£…åé¢ä½¿ç”¨å®ƒé€šå¸¸æ›´æ–¹ä¾¿ã€‚Spring Cloudé€šè¿‡é€»è¾‘çš„EurekaæœåŠ¡æ ‡è¯†ç¬¦(VIPs)è€Œä¸æ˜¯ç‰©ç†urlæ”¯æŒ<code>Feign</code>(ä¸€ä¸ªRESTå®¢æˆ·ç«¯æ„å»ºå™¨)å’Œ<code>Spring RestTemplate</code>çš„è¿œç¨‹è°ƒç”¨ã€‚ä½ è¿˜å¯ä»¥ä½¿ç”¨<code>org.springframework.cloud.client.discovery.DiscoveryClient</code>å®ƒä¸ºå‘ç°å®¢æˆ·ç«¯æä¾›äº†ä¸€ä¸ªç®€å•çš„API(ä¸ç‰¹å®šäºNetflix)ï¼Œå¦‚ä¸‹é¢çš„ç¤ºä¾‹æ‰€ç¤º:</p><div class=highlight><pre class=chroma><code class=language-java data-lang=java><span class=nd>@Autowired</span>
<span class=kd>private</span> <span class=n>DiscoveryClient</span> <span class=n>discoveryClient</span><span class=o>;</span>

<span class=kd>public</span> <span class=n>String</span> <span class=nf>serviceUrl</span><span class=o>()</span> <span class=o>{</span>
    <span class=n>List</span><span class=o>&lt;</span><span class=n>ServiceInstance</span><span class=o>&gt;</span> <span class=n>list</span> <span class=o>=</span> <span class=n>discoveryClient</span><span class=o>.</span><span class=na>getInstances</span><span class=o>(</span><span class=s>&#34;STORES&#34;</span><span class=o>);</span>
    <span class=k>if</span> <span class=o>(</span><span class=n>list</span> <span class=o>!=</span> <span class=kc>null</span> <span class=o>&amp;&amp;</span> <span class=n>list</span><span class=o>.</span><span class=na>size</span><span class=o>()</span> <span class=o>&gt;</span> <span class=n>0</span> <span class=o>)</span> <span class=o>{</span>
        <span class=k>return</span> <span class=n>list</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>0</span><span class=o>).</span><span class=na>getUri</span><span class=o>();</span>
    <span class=o>}</span>
    <span class=k>return</span> <span class=kc>null</span><span class=o>;</span>
<span class=o>}</span>
</code></pre></div><h3 id=110-ä¸ºä»€ä¹ˆæ³¨å†ŒæœåŠ¡å¦‚æ­¤ç¼“æ…¢>1.10 ä¸ºä»€ä¹ˆæ³¨å†ŒæœåŠ¡å¦‚æ­¤ç¼“æ…¢<a href=#110-ä¸ºä»€ä¹ˆæ³¨å†ŒæœåŠ¡å¦‚æ­¤ç¼“æ…¢ class=anchor aria-hidden=true>#</a></h3><p>ä½œä¸ºä¸€ä¸ªå®ä¾‹è¿˜æ¶‰åŠåˆ°åˆ°æ³¨å†Œä¸­å¿ƒçš„å‘¨æœŸæ€§å¿ƒè·³(é€šè¿‡å®¢æˆ·æœºçš„serviceUrl)ï¼Œé»˜è®¤æŒç»­æ—¶é—´ä¸º30ç§’ã€‚åœ¨å®ä¾‹ã€æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯æœ¬åœ°ç¼“å­˜ä¸­éƒ½æœ‰ç›¸åŒçš„å…ƒæ•°æ®ä¹‹å‰ï¼Œå®¢æˆ·ç«¯æ— æ³•å‘ç°æœåŠ¡(å› æ­¤å¯èƒ½éœ€è¦3æ¬¡å¿ƒè·³)ã€‚å¯ä»¥é€šè¿‡è®¾ç½®<code>eureka.instance.leaseRenewalIntervalInSeconds</code>æ¥ä¿®æ”¹å‘¨æœŸã€‚å°†å…¶è®¾ç½®ä¸ºå°äº30çš„å€¼å°†åŠ å¿«ä½¿å®¢æˆ·ç«¯è¿æ¥åˆ°å…¶ä»–æœåŠ¡çš„è¿‡ç¨‹ã€‚åœ¨ç”Ÿäº§ä¸­ï¼Œä½¿ç”¨é»˜è®¤å€¼å¯èƒ½æ›´å¥½ï¼Œå› ä¸ºæœåŠ¡å™¨ä¸­çš„å†…éƒ¨è®¡ç®—ä¼šå¯¹ç§ŸæœŸç»­æœŸåšå‡ºå‡è®¾ã€‚</p><h3 id=111-zones>1.11 Zones<a href=#111-zones class=anchor aria-hidden=true>#</a></h3><p>å¦‚æœæ‚¨å·²ç»å°†Eurekaå®¢æˆ·ç«¯éƒ¨ç½²åˆ°å¤šä¸ªåŒºåŸŸï¼Œæ‚¨å¯èƒ½å¸Œæœ›è¿™äº›å®¢æˆ·ç«¯åœ¨å°è¯•å…¶ä»–åŒºåŸŸä¸­çš„æœåŠ¡ä¹‹å‰å…ˆä½¿ç”¨ç›¸åŒåŒºåŸŸä¸­çš„æœåŠ¡ã€‚è¦è¿›è¡Œè®¾ç½®ï¼Œéœ€è¦æ­£ç¡®é…ç½®Eurekaå®¢æˆ·ç«¯ã€‚
é¦–å…ˆï¼Œæ‚¨éœ€è¦ç¡®ä¿å°†EurekaæœåŠ¡å™¨éƒ¨ç½²åˆ°æ¯ä¸ªåŒºåŸŸï¼Œå¹¶ä¸”å®ƒä»¬å½¼æ­¤æ˜¯å¯¹ç­‰çš„ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…åŒºåŸŸå’Œåœ°åŒºä¸€èŠ‚ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œä½ éœ€è¦å‘Šè¯‰Eurekaä½ çš„æœåŠ¡åœ¨å“ªä¸ªåŒºåŸŸã€‚å¯ä»¥é€šè¿‡ä½¿ç”¨<code>metadatmap</code>å±æ€§æ¥å®ç°ã€‚ä¾‹å¦‚ï¼Œservice 1åŒæ—¶éƒ¨ç½²åœ¨zone 1å’Œzone 2ï¼Œåˆ™éœ€è¦åœ¨service 1ä¸­è®¾ç½®å¦‚ä¸‹Eurekaå±æ€§:</p><p><strong>Service 1 in Zone 1</strong></p><div class=highlight><pre class=chroma><code class=language-yml data-lang=yml><span class=l>eureka.instance.metadataMap.zone = zone1</span><span class=w>
</span><span class=w></span><span class=l>eureka.client.preferSameZoneEureka = true</span><span class=w>
</span></code></pre></div><p><strong>Service 1 in Zone 2</strong></p><div class=highlight><pre class=chroma><code class=language-yml data-lang=yml><span class=l>eureka.instance.metadataMap.zone = zone2</span><span class=w>
</span><span class=w></span><span class=l>eureka.client.preferSameZoneEureka = true</span><span class=w>
</span></code></pre></div><h3 id=112-åˆ·æ–°eurekaå®¢æˆ·ç«¯>1.12 åˆ·æ–°Eurekaå®¢æˆ·ç«¯<a href=#112-åˆ·æ–°eurekaå®¢æˆ·ç«¯ class=anchor aria-hidden=true>#</a></h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code>EurekaClient bean</code>æ˜¯å¯åˆ·æ–°çš„ï¼Œè¿™æ„å‘³ç€å¯ä»¥æ›´æ”¹å’Œåˆ·æ–°Eurekaå®¢æˆ·æœºå±æ€§ã€‚å½“åˆ·æ–°å‘ç”Ÿæ—¶ï¼Œå®¢æˆ·ç«¯å°†ä»EurekaæœåŠ¡å™¨æ³¨é”€ï¼Œå¹¶ä¸”å¯èƒ½æœ‰ä¸€æ®µçŸ­æš‚çš„æ—¶é—´å†…ç»™å®šæœåŠ¡çš„æ‰€æœ‰å®ä¾‹éƒ½ä¸å¯ç”¨ã€‚æ¶ˆé™¤è¿™ç§æƒ…å†µçš„ä¸€ç§æ–¹æ³•æ˜¯ç¦ç”¨åˆ·æ–°Eurekaå®¢æˆ·æœºçš„åŠŸèƒ½ã€‚è®¾ç½®<code>eureka.client.refresh.enable=false</code>ã€‚</p><h3 id=113-ä½¿ç”¨springcloudè´Ÿè½½å‡è¡¡çš„eureka>1.13 ä½¿ç”¨SpringCloudè´Ÿè½½å‡è¡¡çš„Eureka<a href=#113-ä½¿ç”¨springcloudè´Ÿè½½å‡è¡¡çš„eureka class=anchor aria-hidden=true>#</a></h3><p>æˆ‘ä»¬æä¾›å¯¹<code>Spring CLoud LoadBalancer ZonePreferenceServiceInstanceListSupplier</code>çš„æ”¯æŒã€‚Eurekaå®ä¾‹å…ƒæ•°æ®(Eureka.instance. metadatmap zone)ä¸­çš„zoneå€¼ç”¨äºè®¾ç½®spring-cloud-loadbalancer-zoneå±æ€§çš„å€¼ï¼Œè¯¥å±æ€§ç”¨äºæŒ‰zoneè¿‡æ»¤æœåŠ¡å®ä¾‹ã€‚</p><p>å¦‚æœæ²¡æœ‰è¿™ä¸ªå±æ€§ï¼Œå¹¶ä¸”<code>spring.cloud.loadbalancer.eureka.approximateZoneFromHostname</code>æ ‡å¿—è¢«è®¾ç½®ä¸ºtrueï¼Œé‚£ä¹ˆå®ƒå¯ä»¥ä½¿ç”¨æœåŠ¡å™¨ä¸»æœºåä¸­çš„åŸŸåä½œä¸ºåŒºåŸŸçš„ä»£ç†ã€‚</p><p>å¦‚æœæ²¡æœ‰å…¶ä»–åŒºåŸŸæ•°æ®æ¥æºï¼Œåˆ™åŸºäºå®¢æˆ·ç«¯é…ç½®ï¼ˆè€Œä¸æ˜¯å®ä¾‹é…ç½®ï¼‰è¿›è¡ŒçŒœæµ‹ã€‚ æˆ‘ä»¬é‡‡å–<code>eureka.client.availabilityZones</code>ï¼Œå®ƒæ˜¯ä»åŒºåŸŸåç§°åˆ°åŒºåŸŸåˆ—è¡¨çš„åœ°å›¾ï¼Œå¹¶é‡Šæ”¾äº†å®ä¾‹è‡ªå·±çš„åŒºåŸŸçš„ç¬¬ä¸€ä¸ªåŒºåŸŸï¼ˆå³<code>eureka.client.region</code>ï¼Œé»˜è®¤ä¸º<code>us-east-1</code>ï¼Œç”¨äºä¸æœ¬æœºNetflixçš„å…¼å®¹æ€§ï¼‰ã€‚</p><h2 id=2-æœåŠ¡å‘ç°eurekaæœåŠ¡ç«¯>2 æœåŠ¡å‘ç°ï¼šEurekaæœåŠ¡ç«¯<a href=#2-æœåŠ¡å‘ç°eurekaæœåŠ¡ç«¯ class=anchor aria-hidden=true>#</a></h2><p>ä»‹ç»æ­å»ºEurekaæœåŠ¡å™¨çš„æ“ä½œæ­¥éª¤ã€‚</p><h3 id=21-å¦‚ä½•åŒ…å«eurekaæœåŠ¡ç«¯>2.1 å¦‚ä½•åŒ…å«EurekaæœåŠ¡ç«¯<a href=#21-å¦‚ä½•åŒ…å«eurekaæœåŠ¡ç«¯ class=anchor aria-hidden=true>#</a></h3><p>è¦å°†<code>Eureka Server</code>åŒ…å«åˆ°æ‚¨çš„é¡¹ç›®ä¸­ï¼Œä½¿ç”¨gourp IDä¸º<code>org.springframework.cloud</code>å’Œ artifact IDä¸º<code>spring-cloud-start-netflix- Eureka-Server</code>çš„å¯åŠ¨å™¨ã€‚æœ‰å…³ä½¿ç”¨å½“å‰<code>Spring Cloud Release Train</code>è®¾ç½®æ„å»ºç³»ç»Ÿçš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…Spring Cloud Projecté¡µé¢ã€‚</p><blockquote><p>å¦‚æœæ‚¨çš„é¡¹ç›®å·²ç»ä½¿ç”¨<code>Thymeleaf</code>ä½œä¸ºæ¨¡æ¿å¼•æ“ï¼ŒEurekaæœåŠ¡å™¨çš„<code>Freemarker</code>æ¨¡æ¿å¯èƒ½æ— æ³•æ­£ç¡®åŠ è½½ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœ‰å¿…è¦æ‰‹åŠ¨é…ç½®æ¨¡æ¿åŠ è½½å™¨:</p></blockquote><p><strong>application.yml</strong></p><div class=highlight><pre class=chroma><code class=language-yml data-lang=yml><span class=nt>spring</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>freemarker</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>template-loader-path</span><span class=p>:</span><span class=w> </span><span class=l>classpath:/templates/</span><span class=w>
</span><span class=w>    </span><span class=nt>prefer-file-system-access</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span></code></pre></div><h3 id=22-å¦‚ä½•è¿è¡ŒeurekaæœåŠ¡ç«¯>2.2 å¦‚ä½•è¿è¡ŒEurekaæœåŠ¡ç«¯<a href=#22-å¦‚ä½•è¿è¡ŒeurekaæœåŠ¡ç«¯ class=anchor aria-hidden=true>#</a></h3><p>ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†ä¸€ä¸ªæœ€å°çš„EurekaæœåŠ¡å™¨:</p><div class=highlight><pre class=chroma><code class=language-java data-lang=java><span class=nd>@SpringBootApplication</span>
<span class=nd>@EnableEurekaServer</span>
<span class=kd>public</span> <span class=kd>class</span> <span class=nc>Application</span> <span class=o>{</span>

    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>new</span> <span class=n>SpringApplicationBuilder</span><span class=o>(</span><span class=n>Application</span><span class=o>.</span><span class=na>class</span><span class=o>).</span><span class=na>web</span><span class=o>(</span><span class=kc>true</span><span class=o>).</span><span class=na>run</span><span class=o>(</span><span class=n>args</span><span class=o>);</span>
    <span class=o>}</span>

<span class=o>}</span>
</code></pre></div><p>æœåŠ¡å™¨å…·æœ‰ä¸»é¡µï¼Œå…¶ä¸­åŒ…å«UIç•Œé¢å’ŒHTTP APIç«¯ç‚¹ï¼Œä½œç”¨ä¸/eureka/*ã€‚</p><p>ä»¥ä¸‹é“¾æ¥æœ‰ä¸€äº›EurekaèƒŒæ™¯çŸ¥è¯†ï¼Œ<a href=https://github.com/cfregly/fluxcapacitor/wiki/NetflixOSS-FAQ#eureka-service-discovery-load-balancer>flux capacitor</a> and <a href=https://groups.google.com/forum/?fromgroups#!topic/eureka_netflix/g3p2r7gHnN0>google group discussion</a>.</p><p>ç”±äºGradleçš„ä¾èµ–è§£æè§„åˆ™å’Œç¼ºå°‘çˆ¶bomç‰¹æ€§ï¼Œä¾èµ–<code>spring-cloud-start-netflix-eureka-server</code>å¯èƒ½ä¼šå¯¼è‡´åº”ç”¨å¯åŠ¨å¤±è´¥ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæ·»åŠ <code>Spring Boot Gradle</code>æ’ä»¶ï¼Œå¹¶å¯¼å…¥Springäº‘å¯åŠ¨å™¨çš„çˆ¶bomå¦‚ä¸‹:</p><p><strong>build.gradle</strong></p><div class=highlight><pre class=chroma><code class=language-gradle data-lang=gradle><span class=n>buildscript</span> <span class=o>{</span>
  <span class=n>dependencies</span> <span class=o>{</span>
    <span class=n>classpath</span><span class=o>(</span><span class=s2>&#34;org.springframework.boot:spring-boot-gradle-plugin:{spring-boot-docs-version}&#34;</span><span class=o>)</span>
  <span class=o>}</span>
<span class=o>}</span>

<span class=n>apply</span> <span class=nl>plugin:</span> <span class=s2>&#34;spring-boot&#34;</span>

<span class=n>dependencyManagement</span> <span class=o>{</span>
  <span class=n>imports</span> <span class=o>{</span>
    <span class=n>mavenBom</span> <span class=s2>&#34;org.springframework.cloud:spring-cloud-dependencies:{spring-cloud-version}&#34;</span>
  <span class=o>}</span>
<span class=o>}</span>
</code></pre></div><h3 id=23-é«˜å¯ç”¨åŒºåŸŸå’Œåœ°åŒº>2.3 é«˜å¯ç”¨ï¼ŒåŒºåŸŸå’Œåœ°åŒº<a href=#23-é«˜å¯ç”¨åŒºåŸŸå’Œåœ°åŒº class=anchor aria-hidden=true>#</a></h3><p>EurekaæœåŠ¡å™¨æ²¡æœ‰åç«¯å­˜å‚¨ï¼Œä½†æ˜¯æ³¨å†Œä¸­å¿ƒä¸­çš„æœåŠ¡å®ä¾‹éƒ½å¿…é¡»å‘é€å¿ƒè·³ä»¥ä¿æŒå…¶çŠ¶æ€çš„æ›´æ–°(æ‰€ä»¥è¿™å¯ä»¥åœ¨å†…å­˜ä¸­å®Œæˆ)ã€‚å®¢æˆ·ç«¯ä¹Ÿæœ‰ä¸€ä¸ªEurekaæ³¨å†Œçš„å†…å­˜ç¼“å­˜(æ‰€ä»¥ä»–ä»¬ä¸å¿…ä¸ºæ¯ä¸ªæœåŠ¡è¯·æ±‚éƒ½å»æ³¨å†Œä¸­å¿ƒ)ã€‚
é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªEurekaæœåŠ¡å™¨ä¹Ÿæ˜¯ä¸€ä¸ªEurekaå®¢æˆ·ç«¯ï¼Œå¹¶ä¸”éœ€è¦(è‡³å°‘ä¸€ä¸ª)æœåŠ¡URLæ¥å®šä½å¯¹ç­‰ç‚¹ã€‚å¦‚æœä½ ä¸æä¾›å®ƒï¼ŒæœåŠ¡ä¹Ÿä¼šè¿è¡Œå¹¶å·¥ä½œï¼Œä½†å®ƒä¼šç”¨è®¸å¤šå…³äºæ— æ³•æ³¨å†Œè¿›å¯¹ç­‰æ³¨å†Œä¸­å¿ƒçš„ä¿¡æ¯è®°å½•å¡«å……ä½ çš„æ—¥å¿—ã€‚</p><h3 id=24-ç‹¬ç«‹æ¨¡å¼>2.4 ç‹¬ç«‹æ¨¡å¼<a href=#24-ç‹¬ç«‹æ¨¡å¼ class=anchor aria-hidden=true>#</a></h3><p>ä¸¤ä¸ªç¼“å­˜(å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨)å’Œå¿ƒè·³çš„ç»“åˆä½¿ç‹¬ç«‹çš„EurekaæœåŠ¡å™¨åœ¨æ•…éšœæ—¶ç›¸å½“æœ‰å¼¹æ€§ï¼Œåªè¦æœ‰æŸç§ç›‘æ§æˆ–å¼¹æ€§è¿è¡Œæ—¶(å¦‚Cloud Foundry)ä¿æŒå®ƒçš„æ´»åŠ›ã€‚åœ¨ç‹¬ç«‹æ¨¡å¼ä¸‹ï¼Œä½ å¯èƒ½æ›´å¸Œæœ›å…³é—­å®¢æˆ·ç«¯è¡Œä¸ºï¼Œè¿™æ ·å®ƒå°±ä¸ä¼šä¸€ç›´å°è¯•è®¿é—®å…¶ä»–èŠ‚ç‚¹è€Œå¤±è´¥ã€‚ä¸‹é¢çš„ä¾‹å­å±•ç¤ºäº†å¦‚ä½•å…³é—­å®¢æˆ·ç«¯è¡Œä¸º:</p><p><strong>application.yml (ç‹¬ç«‹çš„EurekaæœåŠ¡å™¨)</strong></p><div class=highlight><pre class=chroma><code class=language-yml data-lang=yml><span class=nt>server</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>8761</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=nt>eureka</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>instance</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>hostname</span><span class=p>:</span><span class=w> </span><span class=l>localhost</span><span class=w>
</span><span class=w>  </span><span class=nt>client</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>registerWithEureka</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span><span class=w>    </span><span class=nt>fetchRegistry</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=w>
</span><span class=w>    </span><span class=nt>serviceUrl</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>defaultZone</span><span class=p>:</span><span class=w> </span><span class=l>http://${eureka.instance.hostname}:${server.port}/eureka/</span><span class=w>
</span></code></pre></div><p>æ³¨æ„<code>serviceUrl</code>æŒ‡å‘ä¸æœ¬åœ°å®ä¾‹ç›¸åŒçš„ä¸»æœºã€‚</p><h3 id=25-å¯¹ç­‰æ¨¡å¼>2.5 å¯¹ç­‰æ¨¡å¼<a href=#25-å¯¹ç­‰æ¨¡å¼ class=anchor aria-hidden=true>#</a></h3><p>é€šè¿‡è¿è¡Œå¤šä¸ªå®ä¾‹å¹¶è¦æ±‚å®ƒä»¬ç›¸äº’æ³¨å†Œï¼ŒEurekaå¯ä»¥å˜å¾—æ›´åŠ çµæ´»å’Œå¯ç”¨ã€‚äº‹å®ä¸Šï¼Œè¿™æ˜¯é»˜è®¤çš„è¡Œä¸ºï¼Œæ‰€ä»¥ä½ åªéœ€è¦å‘å¯¹ç­‰ä½“æ·»åŠ ä¸€ä¸ªæœ‰æ•ˆçš„serviceUrlï¼Œå¦‚ä¸‹é¢çš„ä¾‹å­æ‰€ç¤º:</p><p><strong>application.yml (ä¸¤ä¸ªå¯¹ç­‰çš„EurekaæœåŠ¡å™¨)</strong></p><div class=highlight><pre class=chroma><code class=language-yml data-lang=yml><span class=nn>---</span><span class=w>
</span><span class=w></span><span class=nt>spring</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>profiles</span><span class=p>:</span><span class=w> </span><span class=l>peer1</span><span class=w>
</span><span class=w></span><span class=nt>eureka</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>instance</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>hostname</span><span class=p>:</span><span class=w> </span><span class=l>peer1</span><span class=w>
</span><span class=w>  </span><span class=nt>client</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>serviceUrl</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>defaultZone</span><span class=p>:</span><span class=w> </span><span class=l>https://peer2/eureka/</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=nn>---</span><span class=w>
</span><span class=w></span><span class=nt>spring</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>profiles</span><span class=p>:</span><span class=w> </span><span class=l>peer2</span><span class=w>
</span><span class=w></span><span class=nt>eureka</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>instance</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>hostname</span><span class=p>:</span><span class=w> </span><span class=l>peer2</span><span class=w>
</span><span class=w>  </span><span class=nt>client</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>serviceUrl</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>defaultZone</span><span class=p>:</span><span class=w> </span><span class=l>https://peer1/eureka/</span><span class=w>
</span></code></pre></div><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªYAMLæ–‡ä»¶ï¼Œå¯ä»¥é€šè¿‡åœ¨ä¸åŒçš„Springæ–‡ä»¶ä¸­é…ç½®è¿è¡Œå®ƒæ¥åœ¨ä¸¤å°ä¸»æœº(peer1å’Œpeer2)ä¸Šè¿è¡Œç›¸åŒçš„æœåŠ¡å™¨ã€‚é€šè¿‡æ“ä½œ<code>/etc/hosts</code>è§£æä¸»æœºåï¼Œæ‚¨å¯ä»¥ä½¿ç”¨æ­¤é…ç½®åœ¨å•ä¸ªä¸»æœºä¸Šæµ‹è¯•å¯¹ç­‰æ„ŸçŸ¥(åœ¨ç”Ÿäº§ä¸­è¿™æ ·åšæ²¡æœ‰å¤šå¤§ä»·å€¼)ã€‚äº‹å®ä¸Šï¼Œå¦‚æœè¿è¡Œåœ¨çŸ¥é“è‡ªå·±ä¸»æœºåçš„æœºå™¨ä¸Š(é»˜è®¤æƒ…å†µä¸‹ï¼Œä½¿ç”¨<code>java.net.InetAddress</code>æŸ¥æ‰¾)ï¼Œå°±ä¸éœ€è¦<code>eureka.instance.hostname</code>ã€‚</p><p>ä½ å¯ä»¥åœ¨ä¸€ä¸ªç³»ç»Ÿä¸­æ·»åŠ å¤šä¸ªå¯¹ç­‰ä½“ï¼Œåªè¦å®ƒä»¬å½¼æ­¤è‡³å°‘æœ‰ä¸€ä¸ªè¿æ¥ï¼Œå®ƒä»¬å°±ä¼šåŒæ­¥è‡ªå·±çš„æ³¨å†Œã€‚å¦‚æœå¯¹ç­‰ç‚¹åœ¨ç‰©ç†ä¸Šæ˜¯åˆ†ç¦»çš„(åœ¨ä¸€ä¸ªæ•°æ®ä¸­å¿ƒå†…æˆ–å¤šä¸ªæ•°æ®ä¸­å¿ƒä¹‹é—´)ï¼Œé‚£ä¹ˆç³»ç»ŸåŸåˆ™ä¸Šå¯ä»¥æ‰¿å—<code>split-brain</code>ç±»å‹çš„æ•…éšœã€‚ä½ å¯ä»¥åœ¨ä¸€ä¸ªç³»ç»Ÿä¸­æ·»åŠ å¤šä¸ªå¯¹ç­‰ä½“ï¼Œåªè¦å®ƒä»¬éƒ½æ˜¯ç›´æ¥è¿æ¥çš„ï¼Œå®ƒä»¬å°±ä¼šåœ¨è‡ªå·±ä¹‹é—´åŒæ­¥æ³¨å†Œã€‚</p><p><strong>application.yml (ä¸‰ä¸ªå¯¹ç­‰çš„eurekaæœåŠ¡å™¨)</strong></p><div class=highlight><pre class=chroma><code class=language-yml data-lang=yml><span class=nt>eureka</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>client</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>serviceUrl</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>defaultZone</span><span class=p>:</span><span class=w> </span><span class=l>https://peer1/eureka/,http://peer2/eureka/,http://peer3/eureka/</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=nn>---</span><span class=w>
</span><span class=w></span><span class=nt>spring</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>profiles</span><span class=p>:</span><span class=w> </span><span class=l>peer1</span><span class=w>
</span><span class=w></span><span class=nt>eureka</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>instance</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>hostname</span><span class=p>:</span><span class=w> </span><span class=l>peer1</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=nn>---</span><span class=w>
</span><span class=w></span><span class=nt>spring</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>profiles</span><span class=p>:</span><span class=w> </span><span class=l>peer2</span><span class=w>
</span><span class=w></span><span class=nt>eureka</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>instance</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>hostname</span><span class=p>:</span><span class=w> </span><span class=l>peer2</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=nn>---</span><span class=w>
</span><span class=w></span><span class=nt>spring</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>profiles</span><span class=p>:</span><span class=w> </span><span class=l>peer3</span><span class=w>
</span><span class=w></span><span class=nt>eureka</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>instance</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>hostname</span><span class=p>:</span><span class=w> </span><span class=l>peer3</span><span class=w>
</span></code></pre></div><h3 id=26-ä½•æ—¶é€‰æ‹©ipåœ°å€>2.6 ä½•æ—¶é€‰æ‹©IPåœ°å€<a href=#26-ä½•æ—¶é€‰æ‹©ipåœ°å€ class=anchor aria-hidden=true>#</a></h3><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒEurekaæœ€å¥½å‘å¸ƒæœåŠ¡çš„IPåœ°å€è€Œä¸æ˜¯ä¸»æœºåã€‚è®¾ç½®<code>eureka.instance.preferipaddress=true</code>ï¼Œå½“åº”ç”¨ç¨‹åºå‘eurekaæ³¨å†Œæ—¶ï¼Œå®ƒä½¿ç”¨å®ƒçš„IPåœ°å€è€Œä¸æ˜¯å®ƒçš„ä¸»æœºåã€‚</p><blockquote><p>å¦‚æœä¸»æœºåä¸èƒ½ç”±Javaç¡®å®šï¼Œåˆ™å°†IPåœ°å€å‘é€ç»™Eurekaã€‚è®¾ç½®ä¸»æœºåçš„å”¯ä¸€æ–¹æ³•æ˜¯è®¾ç½®eureka.instance.hostnameå±æ€§ã€‚ä½ å¯ä»¥åœ¨è¿è¡Œæ—¶ä½¿ç”¨ç¯å¢ƒå˜é‡è®¾ç½®ä¸»æœºåâ€”ä¾‹å¦‚ï¼š<code>eureka.instance.hostname=${HOST_NAME}</code>ã€‚</p></blockquote><h3 id=27-ä¿æŠ¤eurekaæœåŠ¡å™¨>2.7 ä¿æŠ¤EurekaæœåŠ¡å™¨<a href=#27-ä¿æŠ¤eurekaæœåŠ¡å™¨ class=anchor aria-hidden=true>#</a></h3><p>åªéœ€é€šè¿‡<code>Spring-boot-starter-Security</code>å°†<code>Spring Security</code>æ·»åŠ åˆ°æœåŠ¡å™¨çš„åŒ…ç®¡ç†æ–‡ä»¶ä¸­ï¼Œå°±å¯ä»¥ä¿æŠ¤EurekaæœåŠ¡å™¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“Spring Securityåœ¨åŒ…ç®¡ç†æ–‡ä»¶ä¸­ï¼Œå®ƒå°†è¦æ±‚ä¸€ä¸ªæœ‰æ•ˆçš„CSRFä»¤ç‰Œè¢«å‘é€åˆ°åº”ç”¨ç¨‹åºã€‚Eurekaå®¢æˆ·ç«¯é€šå¸¸ä¸ä¼šæ‹¥æœ‰ä¸€ä¸ªæœ‰æ•ˆçš„è·¨ç«™è¯·æ±‚ä¼ªé€ (CSRF)ä»¤ç‰Œï¼Œä½ éœ€è¦ä¸º<code>/Eureka/**</code>ç«¯ç‚¹ç¦ç”¨è¿™ä¸ªè¦æ±‚ã€‚ä¾‹å¦‚:</p><div class=highlight><pre class=chroma><code class=language-java data-lang=java><span class=nd>@EnableWebSecurity</span>
<span class=kd>class</span> <span class=nc>WebSecurityConfig</span> <span class=kd>extends</span> <span class=n>WebSecurityConfigurerAdapter</span> <span class=o>{</span>

    <span class=nd>@Override</span>
    <span class=kd>protected</span> <span class=kt>void</span> <span class=nf>configure</span><span class=o>(</span><span class=n>HttpSecurity</span> <span class=n>http</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>Exception</span> <span class=o>{</span>
        <span class=n>http</span><span class=o>.</span><span class=na>csrf</span><span class=o>().</span><span class=na>ignoringAntMatchers</span><span class=o>(</span><span class=s>&#34;/eureka/**&#34;</span><span class=o>);</span>
        <span class=kd>super</span><span class=o>.</span><span class=na>configure</span><span class=o>(</span><span class=n>http</span><span class=o>);</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></div><p>æœ‰å…³CSRFçš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜…<a href=https://docs.spring.io/spring-security/site/docs/current/reference/htmlsingle/#csrf>Spring Security</a>æ–‡æ¡£ã€‚
åœ¨Spring Cloud Samples <a href=https://github.com/spring-cloud-samples/eureka/tree/Eureka-With-Security>repo</a>ä¸­å¯ä»¥æ‰¾åˆ°ä¸€ä¸ªæ¼”ç¤ºEureka Serverã€‚</p><h3 id=28-jdk11æ”¯æŒ>2.8 JDK11æ”¯æŒ<a href=#28-jdk11æ”¯æŒ class=anchor aria-hidden=true>#</a></h3><p>JDK 11åˆ é™¤äº†EurekaæœåŠ¡å™¨æ‰€ä¾èµ–çš„JAXBæ¨¡å—ã€‚å¦‚æœä½ æƒ³åœ¨è¿è¡ŒEurekaæœåŠ¡å™¨æ—¶ä½¿ç”¨JDK 11ï¼Œä½ å¿…é¡»åœ¨ä½ çš„POMæˆ–Gradleæ–‡ä»¶ä¸­åŒ…å«è¿™äº›ä¾èµ–é¡¹ã€‚</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>&lt;dependency&gt;
    &lt;groupId&gt;org.glassfish.jaxb&lt;/groupId&gt;
    &lt;artifactId&gt;jaxb-runtime&lt;/artifactId&gt;
&lt;/dependency&gt;
</code></pre></div><h2 id=3-é…ç½®å±æ€§>3 é…ç½®å±æ€§<a href=#3-é…ç½®å±æ€§ class=anchor aria-hidden=true>#</a></h2><p>è¦æŸ¥çœ‹æ‰€æœ‰Spring Cloud Netflixç›¸å…³é…ç½®å±æ€§çš„åˆ—è¡¨ï¼Œè¯·æ£€æŸ¥<a href=https://docs.spring.io/spring-cloud-netflix/docs/current/reference/html/appendix.html>é™„å½•é¡µé¢</a>ã€‚</p><p class=edit-page><a href=https://github.com/KevinBlandy/springcloud.io//blob/master/content/docs/SpringCloud/Spring%20Cloud%20Netflix.md><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-edit-2"><path d="M17 3a2.828 2.828.0 114 4L7.5 20.5 2 22l1.5-5.5L17 3z"/></svg>Edit this page on GitHub</a></p><div class=my-n3></div></main></div></div></div><footer class="footer text-muted"><div class=container><div class=row><div class="col-lg-8 order-last order-lg-first"><ul class=list-inline><li class=list-inline-item>Powered by <a href=https://www.netlify.com/>Netlify</a>, <a href=https://gohugo.io/>Hugo</a>, and <a href=https://getdoks.org/>Doks</a></li></ul></div><div class="col-lg-8 order-first order-lg-last text-lg-end"><ul class=list-inline><li class=list-inline-item><a href=https://www.springcloud.io/about/>å…³äº</a></li><li class=list-inline-item><a href=https://www.springcloud.io/thanks/>é¸£è°¢</a></li><li class=list-inline-item><a href=https://github.com/KevinBlandy/springcloud.io>Github</a></li><li class=list-inline-item><a href=https://springboot.io>è®ºå›</a></li></ul></div></div></div></footer><script src=https://www.springcloud.io/js/bootstrap.min.d67050adf5d370668aede4201f82af781b16970934804995a1ca37c1ee9222c2fc530972aa6d5d2b6124caf1fe318f139aac99df2c1e89af65504fc1185c7972.js integrity="sha512-1nBQrfXTcGaK7eQgH4KveBsWlwk0gEmVoco3we6SIsL8Uwlyqm1dK2EkyvH+MY8TmqyZ3yweia9lUE/BGFx5cg==" crossorigin=anonymous defer></script><script src=https://www.springcloud.io/js/highlight.min.21fbbff4ae23e5143eb2cab64edbdb48eb90be561eb53ee5766f2ef52ef0a1c917325706a2cdd769342b64b418c3b3030d8272769e72be6d3798fa05b0018c08.js integrity="sha512-Ifu/9K4j5RQ+ssq2TtvbSOuQvlYetT7ldm8u9S7wockXMlcGos3XaTQrZLQYw7MDDYJydp5yvm03mPoFsAGMCA==" crossorigin=anonymous defer></script><script src=https://www.springcloud.io/main.min.773144977fe359704aa8b57933ee2f435ba70c66684dfa06b01c50cf8131162bd2680301697f8d788259ff49ea7dc4d5f02683ad9ed0d53f22e99dddaeab1bab.js integrity="sha512-dzFEl3/jWXBKqLV5M+4vQ1unDGZoTfoGsBxQz4ExFivSaAMBaX+NeIJZ/0nqfcTV8CaDrZ7Q1T8i6Z3drqsbqw==" crossorigin=anonymous defer></script><script src=https://www.springcloud.io/index.min.3f0f46b8b0ed5034dfea20e2d7446efb5279f217703d29aed1fde7e1785276697fcc47ab9a9cb44d7c6f88ca263cd1f09842053695effde585a35f511c472dc3.js integrity="sha512-Pw9GuLDtUDTf6iDi10Ru+1J58hdwPSmu0f3n4XhSdml/zEermpy0TXxviMomPNHwmEIFNpXv/eWFo19RHEctww==" crossorigin=anonymous defer></script></body></html>